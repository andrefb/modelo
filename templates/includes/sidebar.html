<!-- Backdrop escuro (Mantém igual) -->
<div id="sidebar-backdrop" onclick="toggleSidebar()" class="fixed inset-0 z-20 bg-black/50 hidden lg:hidden glass"></div>

<!-- Sidebar -->
<aside id="sidebar" class="fixed inset-y-0 right-0 z-30 w-64 bg-white transform translate-x-full lg:static lg:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col h-screen shadow-2xl lg:shadow-none lg:border-r border-gray-200">
    
    <!-- Header da Sidebar -->
    <div class="hidden lg:flex items-center justify-center h-16 border-b border-gray-100 bg-brand text-white">
        <span class="text-xl font-bold tracking-wide flex items-center gap-2">
            <!-- Ícone da Empresa -->
            <div class="w-8 h-8 rounded bg-white/20 flex items-center justify-center">
                <i class="ph ph-buildings text-xl"></i>
            </div>
            <!-- Nome Dinâmico -->
            <span class="truncate max-w-[150px]" title="{{ request.company.trade_name|default:request.company.legal_name }}">
                {{ request.company.trade_name|default:request.company.legal_name|default:"Empresa" }}
            </span>
        </span>
    </div>

    <!-- Header Mobile -->
    <div class="flex lg:hidden items-center justify-between p-4 border-b border-gray-100">
        <span class="text-sm font-bold text-slate-500">MENU</span>
        <button onclick="toggleSidebar()" class="text-slate-400 hover:text-red-500">
            <i class="ph ph-x text-2xl"></i>
        </button>
    </div>

    <!-- MENU DE NAVEGAÇÃO -->
    <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto">
        
        <!-- 1. DASHBOARD (Todos veem) -->
        <a href="{% url 'home' %}" class="flex items-center gap-3 px-4 py-3 text-sm font-medium bg-brand-surface text-brand rounded-lg">
            <i class="ph ph-squares-four text-xl"></i>
            Dashboard
        </a>

        <!-- 2. CLIENTES (Todos veem) -->
        <a href="#" class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-slate-600 hover:bg-gray-50 hover:text-brand rounded-lg transition-colors">
            <i class="ph ph-users text-xl"></i>
            Clientes
        </a>

        <!-- 3. PROPOSTAS (Todos veem) -->
        <a href="#" class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-slate-600 hover:bg-gray-50 hover:text-brand rounded-lg transition-colors">
            <i class="ph ph-file-text text-xl"></i>
            Propostas
        </a>

        <!-- BLOCÃO RESTRITO: Apenas Admin e Financeiro -->
        {% if request.membership.role == 'admin' or request.membership.role == 'financial' %}
            
            <div class="pt-4 mt-4 border-t border-gray-100">
                <p class="px-4 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Gestão</p>
                
                <!-- 4. FINANCIAMENTOS -->
                <a href="#" class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-slate-600 hover:bg-gray-50 hover:text-brand rounded-lg transition-colors">
                    <i class="ph ph-bank text-xl"></i>
                    Financiamentos
                </a>

                <!-- 5. USUÁRIOS -->
                <a href="#" class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-slate-600 hover:bg-gray-50 hover:text-brand rounded-lg transition-colors">
                    <i class="ph ph-users-three text-xl"></i>
                    Usuários
                </a>

                <!-- 6. EMPRESA -->
                <a href="{% url 'company_detail' %}" class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-slate-600 hover:bg-gray-50 hover:text-brand rounded-lg transition-colors">
                    <i class="ph ph-buildings text-xl"></i>
                    Empresa
                </a>
            </div>

        {% endif %}

    </nav>

    <!-- Footer (User) -->
    <div class="p-4 border-t border-gray-100 bg-gray-50 lg:bg-white">
        {% if user.is_authenticated %}
        <div class="flex items-center gap-3 px-4 py-3 mb-2">
            <div class="w-8 h-8 rounded-full bg-brand text-white flex items-center justify-center text-sm font-bold shadow-sm">
                {{ user.email|first|upper }}
            </div>
            <div class="overflow-hidden">
                <p class="text-sm font-medium text-slate-900 truncate">{{ user.name|default:"Usuário" }}</p>
                <!-- Mostra o Cargo atual para facilitar -->
                <p class="text-xs text-brand font-semibold truncate">
                    {{ request.membership.get_role_display }}
                </p>
            </div>
        </div>
        
        <form action="{% url 'account_logout' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="w-full flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-red-600 bg-white border border-gray-200 hover:bg-red-50 rounded-lg transition-colors shadow-sm">
                <i class="ph ph-sign-out"></i> Sair
            </button>
        </form>
        {% endif %}
    </div>
</aside>